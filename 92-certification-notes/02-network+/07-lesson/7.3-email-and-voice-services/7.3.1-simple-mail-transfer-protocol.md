## 7.3.1 – Simple Mail Transfer Protocol (SMTP)  
#networking-plus #simplemail #SMTP

---

### 📬 What Is SMTP?

**SMTP (Simple Mail Transfer Protocol)** defines **how email is sent** from one system to another. It is responsible for the **sending**, **relaying**, and **forwarding** of mail—not for retrieval.

- SMTP works with domain names and uses **DNS MX (Mail Exchange) records** to locate the recipient’s mail server.
- It typically works between **mail servers**, but it can also be used by **mail clients** to send outgoing messages to a mail server.
- SMTP does **not** store mail permanently—it attempts delivery and returns a **Non-Delivery Report (NDR)** if it fails.

---

### 🧱 The SMTP Message Flow

#### Step-by-step process from Local Client to Remote Inbox:

1. **Local Mail Client → Local SMTP Server (Port 587)**
   - A user composes an email and clicks "Send."
   - The client submits the message to the local SMTP server via **Port 587**, using **STARTTLS** for secure transmission.

2. **Local SMTP Server → Remote SMTP Server (Port 25)**
   - The local SMTP server looks up the **MX record** for the recipient domain.
   - It connects to the remote SMTP server over **Port 25** to hand off the message.

3. **Remote SMTP Server → Remote IMAP Server**
   - The remote SMTP server receives the message and stores it in the **recipient's mailbox** (typically on an **IMAP server**).

4. **Remote Mail Client → Remote IMAP Server**
   - The recipient’s mail client accesses the mailbox using **IMAP** (or sometimes POP3) to download or view the message.

---

### 🔐 SMTP Security: TLS Options

SMTP can use **Transport Layer Security (TLS)** to encrypt messages in transit. Two main options:

- **STARTTLS**  
  - Upgrades an existing unencrypted connection to TLS.
  - Also known as **explicit TLS** or **opportunistic TLS**.
  - Deprecated, but still widely used.

- **Implicit TLS**  
  - Establishes a secure TLS connection **before** any SMTP commands are exchanged.
  - Considered the **preferred method**.

---

### 📦 Common SMTP Ports

| Port | Usage | Security | Description |
|------|-------|----------|-------------|
| **25**  | Message relay | Optional STARTTLS | Used between SMTP servers (MTA-to-MTA). Can support STARTTLS if both ends allow. |
| **465** | Submission | Implicit TLS | Deprecated port, but still used for mail submission with encryption (MSA). |
| **587** | Submission | STARTTLS (explicit) | Recommended for **mail client to server** submission with authentication. |

---

### 🧠 Key Concepts

- SMTP is for **sending** mail, not receiving it.
- SMTP uses **DNS MX records** to locate destination servers.
- If delivery fails, SMTP sends a **NDR** with a failure reason.
- **IMAP or POP3** handles **retrieving** mail from the server to the client.
- Port `25` is still used between servers, but **587** is the modern standard for clients.

---

### 📌 Analogy

> **SMTP is the postal service truck**—it picks up your letter (email) and drives it to the recipient’s post office (mail server). It doesn’t wait around. If no one accepts it, it brings it back with a failure notice (NDR).

---

