#networking-plus #security #internet-protocol-security #IPSec #AH #ESP 

## 13.2.3 Internet Protocol Security (IPSec)

### üß± What It Is
- Used to secure **IPv4** and/or **IPv6** communications on local networks and for remote access VPNs.
- **Layer**: Network (Layer 3) ‚Üí works independently of specific applications.
- Benefits:
  - Less packet overhead than application-layer solutions.
  - Can operate without special app configuration.

---

### üß± Core Protocols
- **Authentication Header (AH)**:
  - Applies cryptographic hash to entire packet (IP header + data).
  - Uses shared secret key to create **Integrity Check Value (ICV)**.
  - Confirms packet integrity and authenticity.
  - ‚ùå No encryption ‚Üí no confidentiality.

- **Encapsulating Security Payload (ESP)**:
  - Encrypts packet payload.
  - Adds header, trailer (padding for crypto), and ICV.
  - Excludes IP header from ICV calculation.
  - ‚úÖ Provides confidentiality (with symmetric ciphers) + optional integrity/authentication.

üí° With ESP, confidentiality + integrity are often combined, but either can be used alone.

---

### üß± IPSec Modes
- **Transport Mode**:
  - Secures end-to-end communication between hosts.
  - ESP encrypts payload only; IP header stays visible.
  - AH (if used) can protect IP header integrity.
  - Used for private network host-to-host protection.

- **Tunnel Mode**:
  - Used between VPN gateways over insecure networks.
  - Entire original packet (header + payload) is encrypted and wrapped with a new IP header.
  - AH rarely used here ‚Üí confidentiality is typically required.
  - Common in site-to-site VPNs.

---

### üß± IPv4 vs IPv6 Differences
- Principles are the same, but header formats differ.
- IPv6 uses **extension headers**.
- IPv4 assigns protocol numbers:
  - ESP ‚Üí 50
  - AH ‚Üí 51
- Packet handling depends on mode (transport or tunnel):
  - Modify original header.
  - Or encapsulate original packet entirely.

---

### ‚úÖ Key Takeaway
IPSec is the **Swiss Army knife of VPN security**:
- AH = **security guard** checking ID & ensuring no tampering.
- ESP = **locked briefcase** ensuring no one sees inside.
- Modes decide whether you just secure the contents (transport) or the entire delivery box (tunnel).
